generator client {
  provider        = "prisma-client"
  output   = "../src/generated/prisma"
  previewFeatures = ["strictUndefinedChecks"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(uuid())
  name          String
  email         String    @unique
  password      String
  role          UserRole  @default(USER)
  isHost        Boolean   @default(false)
  gender        Gender    @default(MALE)
  dob           DateTime?
  address       String?
  contactNumber String?
  bio           String?
  profileImage  String?
  status        Status    @default(ACTIVE)
  isDeleted     Boolean   @default(false)
  isVerified    Boolean   @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  hosts             Host?
  eventParticipants EventParticipant[]
  payments          Payment[]

  @@map("users")
}

model Host {
  id                String @id @default(uuid())
  userId            String @unique
  user              User   @relation(fields: [userId], references: [id])
  rating            Float  @default(0)
  totalEventsHosted Int    @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  events            Event[]
  eventParticipants EventParticipant[]

  @@map("hosts")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  USER
  HOST
}

enum Gender {
  MALE
  FEMALE
}

enum Status {
  ACTIVE
  INACTIVE
  BLOCKED
}

model Event {
  id String @id @default(uuid())

  title           String
  slug            String      @unique
  category        String
  description     String
  date            DateTime
  time            String // will store: "10:00 AM"
  location        String
  minParticipants Int
  maxParticipants Int
  fee             Float       @default(0)
  images          String[]
  status          EventStatus @default(OPEN)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  host      Host     @relation(fields: [hostId], references: [id])
  hostId    String

  eventParticipants EventParticipant[]
  payments          Payment[]

  @@map("events")
}

enum EventStatus {
  OPEN
  FULL
  CANCELLED
  COMPLETED
}

model EventParticipant {
  id String @id @default(uuid())

  eventId String
  event   Event  @relation(fields: [eventId], references: [id])

  hostId String
  host   Host   @relation(fields: [hostId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id])

  joinStatus    JoinStatus    @default(PENDING)
  paymentStatus PaymentStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([eventId, userId])
  @@map("event_participants")
}

enum JoinStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

model Payment {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  eventId String
  event   Event  @relation(fields: [eventId], references: [id])

  amount Float

  transactionId String
  paymentStatus PaymentStatus @default(PENDING)

  paymentGatewayData String?

  invoiceUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payments")
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}
